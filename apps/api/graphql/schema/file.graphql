"""
File management
"""
type File {
	id: ID!
	virtualPath: String!
	name: String!
	mimeType: String!
	size: Float!
	hash: String
	remoteId: String!
	providerId: ID!
	folderId: ID
	uploadedBy: ID!
	isDeleted: Boolean!
	starred: Boolean!
	createdAt: DateTime!
	updatedAt: DateTime!
	lifecycle: FileLifecycle!

	"""
	Storage provider
	"""
	provider: StorageProvider!

	"""
	Parent folder
	"""
	folder: Folder

	"""
	User who uploaded
	"""
	user: User!
}

enum FileLifecycleState {
	HOT
	ARCHIVED
	RESTORE_REQUESTED
	RESTORING
	RESTORED_TEMPORARY
	UNKNOWN
}

enum RestoreTier {
	FAST
	STANDARD
	BULK
}

type FileLifecycle {
	state: FileLifecycleState!
	storageClass: String
	restoreRequestedAt: DateTime
	restoreExpiresAt: DateTime
	lastCheckedAt: DateTime
}

type FileConnection {
	files: [File!]!
	total: Int!
	hasMore: Boolean!
}

"""
Files and folders at a given location
"""
type PathContents {
	files: [File!]!
	folders: [Folder!]!
	folder: Folder
}

extend type Query {
	"""
	Get file by ID
	"""
	file(id: ID!): File!

	"""
	Get files in a folder (by folderId)
	"""
	files(folderId: ID, limit: Int, offset: Int): FileConnection!

	"""
	Get files and folders at a location.
	Pass folderId to browse a folder, or omit for root.
	Pass providerIds to filter by specific providers.
	"""
	contents(folderId: ID, providerIds: [ID!]): PathContents!

	"""
	Search files by name
	"""
	searchFiles(query: String!, limit: Int): [File!]!

	"""
	Semantic AI search for files
	"""
	searchFilesAi(query: String!, limit: Int): [File!]!

	"""
	Search folders by name
	"""
	searchFolders(query: String!, limit: Int): [Folder!]!

	"""
	Get recent files sorted by latest created/updated timestamp
	"""
	recentFiles(limit: Int): [File!]!

	"""
	Get starred files
	"""
	starredFiles: [File!]!

	"""
	List active download links for a file
	"""
	fileDownloadLinks(fileId: ID!): [FileDownloadLink!]!

	"""
	Get active upload sessions for the current user
	"""
	activeUploadSessions: [UploadSessionInfo!]!
}

extend type Mutation {
	"""
	Request file upload (returns upload URL)
	"""
	requestUpload(input: RequestUploadInput!): UploadResponse!

	"""
	Request file download (returns direct URL or API proxy URL)
	"""
	requestDownload(id: ID!): DownloadResponse!

	"""
	Create a download link for a file
	"""
	createFileDownloadLink(input: CreateFileDownloadLinkInput!): FileDownloadLink!

	"""
	Rename a file
	"""
	renameFile(id: ID!, name: String!): File!

	"""
	Move file to different folder
	"""
	moveFile(id: ID!, folderId: ID): File!

	"""
	Move file to a different storage provider (queued background transfer)
	"""
	moveFileToProvider(id: ID!, providerId: ID!): File!
	archiveFile(id: ID!): Job!
	requestFileRestore(id: ID!, input: RequestFileRestoreInput!): Job!
	refreshFileLifecycle(id: ID!): FileLifecycle!

	"""
	Delete file (soft delete)
	"""
	deleteFile(id: ID!): Boolean!

	"""
	Star a file
	"""
	starFile(id: ID!): File!

	"""
	Unstar a file
	"""
	unstarFile(id: ID!): File!

	"""
	Revoke a file download link
	"""
	revokeFileDownloadLink(id: ID!): Boolean!

	"""
	Initiate a chunked upload session for large files
	"""
	initiateChunkedUpload(
		input: InitiateChunkedUploadInput!
	): ChunkedUploadSession!

	"""
	Cancel an active upload session
	"""
	cancelUploadSession(sessionId: ID!): Boolean!

	"""
	Retry a failed upload session
	"""
	retryUploadSession(sessionId: ID!): Boolean!

	"""
	Complete an S3 multipart upload by providing part ETags
	"""
	completeS3MultipartUpload(sessionId: ID!, parts: [S3PartInput!]!): Boolean!
}

extend type Subscription {
	"""
	Real-time upload progress events
	"""
	uploadProgress(sessionId: ID!): UploadProgressEvent!
}

input RequestUploadInput {
	name: String!
	mimeType: String!
	size: Float!
	folderId: ID
	providerId: ID!
}

input RequestFileRestoreInput {
	days: Int!
	tier: RestoreTier = STANDARD
}

type UploadResponse {
	fileId: ID!
	uploadUrl: String
	uploadFields: JSON
	useDirectUpload: Boolean!
}

type DownloadResponse {
	fileId: ID!
	downloadUrl: String
	useDirectDownload: Boolean!
}

type FileDownloadLink {
	id: ID!
	token: String!
	fileId: ID!
	maxDownloads: Int!
	downloadCount: Int!
	downloadsRemaining: Int!
	expiresAt: DateTime!
	lastAccessedAt: DateTime
	revokedAt: DateTime
	createdAt: DateTime!
	updatedAt: DateTime!
	downloadLinkUrl: String!
}

input CreateFileDownloadLinkInput {
	fileId: ID!
	maxDownloads: Int!
	expiresAt: DateTime!
}

"""
Chunked upload session types
"""
input InitiateChunkedUploadInput {
	name: String!
	mimeType: String!
	totalSize: Float!
	chunkSize: Float
	folderId: ID
	providerId: ID!
}

type ChunkedUploadSession {
	sessionId: ID!
	totalChunks: Int!
	chunkSize: Float!
	useDirectUpload: Boolean!
	presignedPartUrls: [PresignedPartUrl!]
}

type PresignedPartUrl {
	partNumber: Int!
	url: String!
}

input S3PartInput {
	partNumber: Int!
	etag: String!
}

type UploadProgressEvent {
	sessionId: ID!
	status: String!
	phase: String!
	receivedChunks: Int!
	totalChunks: Int!
	providerBytesTransferred: Float!
	totalSize: Float!
	errorMessage: String
}

type UploadSessionInfo {
	sessionId: ID!
	fileName: String!
	totalSize: Float!
	status: String!
	phase: String!
	receivedChunks: Int!
	totalChunks: Int!
	providerBytesTransferred: Float!
	errorMessage: String
	createdAt: String!
}
